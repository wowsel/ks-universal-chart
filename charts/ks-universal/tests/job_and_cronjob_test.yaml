suite: Job and CronJob tests
templates:
  - job.yaml
  - cronjob.yaml

tests:
  - it: should handle deployment with migrations
    values:
      - ./values/deployment-with-migrations.yaml
    asserts:
      - template: job.yaml
        equal:
          path: kind
          value: Job
      - template: job.yaml
        equal:
          path: metadata.name
          value: app-with-migrations-migrations
      - template: job.yaml
        equal:
          path: spec.backoffLimit
          value: 3

  - it: should handle jobs with backoff limit
    values:
      - ./values/job-with-backoff.yaml
    asserts:
      - template: job.yaml
        equal:
          path: kind
          value: Job
      - template: job.yaml
        equal:
          path: spec.activeDeadlineSeconds
          value: 600
      - template: job.yaml
        equal:
          path: spec.backoffLimit
          value: 3

  - it: should properly configure cronjob
    values:
      - ./values/cronjob-config.yaml
    asserts:
      - template: cronjob.yaml
        equal:
          path: kind
          value: CronJob
      - template: cronjob.yaml
        equal:
          path: spec.schedule
          value: "0 * * * *"
      - template: cronjob.yaml
        equal:
          path: spec.successfulJobsHistoryLimit
          value: 3
      - template: cronjob.yaml
        equal:
          path: spec.failedJobsHistoryLimit
          value: 1
      - template: cronjob.yaml
        equal:
          path: spec.concurrencyPolicy
          value: Forbid 