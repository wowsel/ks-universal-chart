# job_test.yaml
suite: Job tests
templates:
  - job.yaml
tests:
  - it: should create basic job
    values:
      - ./values/job.yaml
    asserts:
      - isKind:
          of: Job
      - equal:
          path: spec.template.spec.containers[0].image
          value: backup-tool:v1.0

  - it: should create migration job
    values:
      - ./values/migrations.yaml
    asserts:
      - isKind:
          of: Job
      - equal:
          path: metadata.name
          value: app1-migrations
      - equal:
          path: spec.backoffLimit
          value: 3
      - contains:
          path: metadata.annotations
          content:
            helm.sh/hook: pre-install,pre-upgrade
