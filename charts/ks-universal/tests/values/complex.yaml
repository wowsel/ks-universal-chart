# charts/ks-universal/tests/values/complex.yaml
# Комплексный тестовый сценарий со всеми функциями
deploymentsGeneral:
  autoCreateServiceMonitor: true
  autoCreateSoftAntiAffinity: true

deployments:
  app1:
    containers:
      main:
        image: app
        imageTag: v1.0
        ports:
          http:
            containerPort: 80
          http-metrics:
            containerPort: 9113
        env:
          - name: ENV
            value: "production"
        resources:
          limits:
            cpu: "1"
            memory: "1Gi"
          requests:
            cpu: "500m"
            memory: "512Mi"
        probes:
          livenessProbe:
            httpGet:
              path: /health
              port: http
    hpa:
      minReplicas: 2
      maxReplicas: 5
      metrics:
        - type: Resource
          resource:
            name: cpu
            target:
              type: Utilization
              averageUtilization: 80
    pdb:
      minAvailable: 1
    serviceAccount:
      annotations:
        eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/my-role
    migrations:
      enabled: true
      args: ["db:migrate"]
    serviceMonitor:
      interval: 30s

configs:
  app-config:
    type: configmap
    data:
      APP_ENV: production
  app-secrets:
    type: secret
    data:
      api-key: c2VjcmV0

ingresses:
  app1:
    tls:
      - secretName: app1-tls
        hosts:
          - app1.example.com
    hosts:
      - host: app1.example.com
        paths:
          - path: /
            pathType: Prefix
            port: 80