suite: Deployment tests
templates:
  - deployment.yaml
tests:
  - it: should create deployment with basic configuration
    values:
      - ./values/basic.yaml
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: spec.template.spec.containers[0].image
          value: nginx:1.21

  - it: should properly merge multiple containers configurations
    values:
      - ./values/multi-container.yaml
    asserts:
      - lengthEqual:
          path: spec.template.spec.containers
          count: 2

  - it: should handle tpl in values
    set:
      global:
        registry: docker.io
        version: v1.2.3
      deployments:
        app1:
          containers:
            main:
              image: "{{ .Values.global.registry }}/nginx"
              imageTag: "{{ .Values.global.version }}"
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: docker.io/nginx:v1.2.3
